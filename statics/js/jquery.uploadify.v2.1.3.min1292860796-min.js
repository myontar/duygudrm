if(jQuery){(function(b){b.extend(b.fn,{uploadify:function(a){b(this).each(function(){settings=b.extend({id:b(this).attr("id"),uploader:"uploadify.swf",script:"uploadify.php",expressInstall:null,folder:"",height:30,width:120,cancelImg:"cancel.png",wmode:"opaque",scriptAccess:"sameDomain",fileDataName:"Filedata",method:"POST",queueSizeLimit:999,simUploadLimit:1,queueID:false,displayData:"percentage",removeCompleted:true,onInit:function(){},onSelect:function(){},onQueueFull:function(){},onCheck:function(){},onCancel:function(){},onClearQueue:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},a);var j=location.pathname;j=j.split("/");j.pop();j=j.join("/")+"/";var i={};i.uploadifyID=settings.id;i.pagepath=j;if(settings.buttonImg){i.buttonImg=escape(settings.buttonImg)}if(settings.buttonText){i.buttonText=escape(settings.buttonText)}if(settings.rollover){i.rollover=true}i.script=settings.script;i.folder=escape(settings.folder);if(settings.scriptData){var h="";for(var k in settings.scriptData){h+="&"+k+"="+settings.scriptData[k]}i.scriptData=escape(h.substr(1))}i.width=settings.width;i.height=settings.height;i.wmode=settings.wmode;i.method=settings.method;i.queueSizeLimit=settings.queueSizeLimit;i.simUploadLimit=settings.simUploadLimit;if(settings.hideButton){i.hideButton=true}if(settings.fileDesc){i.fileDesc=settings.fileDesc}if(settings.fileExt){i.fileExt=settings.fileExt}if(settings.multi){i.multi=true}if(settings.auto){i.auto=true}if(settings.sizeLimit){i.sizeLimit=settings.sizeLimit}if(settings.checkScript){i.checkScript=settings.checkScript}if(settings.fileDataName){i.fileDataName=settings.fileDataName}if(settings.queueID){i.queueID=settings.queueID}if(settings.onInit()!==false){b(this).css("display","none");b(this).after('<div id="'+b(this).attr("id")+'Uploader"></div>');swfobject.embedSWF(settings.uploader,settings.id+"Uploader",settings.width,settings.height,"9.0.24",settings.expressInstall,i,{quality:"high",wmode:settings.wmode,allowScriptAccess:settings.scriptAccess},{},function(c){if(typeof(settings.onSWFReady)=="function"&&c.success){settings.onSWFReady()}});if(settings.queueID==false){b("#"+b(this).attr("id")+"Uploader").after('<div id="'+b(this).attr("id")+'Queue" class="uploadifyQueue"></div>')}else{b("#"+settings.queueID).addClass("uploadifyQueue")}}if(typeof(settings.onOpen)=="function"){b(this).bind("uploadifyOpen",settings.onOpen)}b(this).bind("uploadifySelect",{action:settings.onSelect,queueID:settings.queueID},function(f,n,g){if(f.data.action(f,n,g)!==false){var e=Math.round(g.size/1024*100)*0.01;var d="KB";if(e>1000){e=Math.round(e*0.001*100)*0.01;d="MB"}var c=e.toString().split(".");if(c.length>1){e=c[0]+"."+c[1].substr(0,2)}else{e=c[0]}if(g.name.length>20){fileName=g.name.substr(0,20)+"..."}else{fileName=g.name}queue="#"+b(this).attr("id")+"Queue";if(f.data.queueID){queue="#"+f.data.queueID}b(queue).append('<div id="'+b(this).attr("id")+n+'" class="uploadifyQueueItem"><div class="cancel"><a href="javascript:jQuery(\'#'+b(this).attr("id")+"').uploadifyCancel('"+n+'\')"><img src="'+settings.cancelImg+'" border="0" /></a></div><span class="fileName">'+fileName+" ("+e+d+')</span><span class="percentage"></span><div class="uploadifyProgress"><div id="'+b(this).attr("id")+n+'ProgressBar" class="uploadifyProgressBar"><!--Progress Bar--></div></div></div>')}});if(typeof(settings.onSelectOnce)=="function"){b(this).bind("uploadifySelectOnce",settings.onSelectOnce)}b(this).bind("uploadifyQueueFull",{action:settings.onQueueFull},function(d,c){if(d.data.action(d,c)!==false){alert("The queue is full.  The max size is "+c+".")}});b(this).bind("uploadifyCheckExist",{action:settings.onCheck},function(c,d,e,f,q){var g=new Object();g=e;g.folder=(f.substr(0,1)=="/")?f:j+f;if(q){for(var p in e){var r=p}}b.post(d,g,function(m){for(var o in m){if(c.data.action(c,m,o)!==false){var n=confirm("Do you want to replace the file "+m[o]+"?");if(!n){document.getElementById(b(c.target).attr("id")+"Uploader").cancelFileUpload(o,true,true)}}}if(q){document.getElementById(b(c.target).attr("id")+"Uploader").startFileUpload(r,true)}else{document.getElementById(b(c.target).attr("id")+"Uploader").startFileUpload(null,true)}},"json")});b(this).bind("uploadifyCancel",{action:settings.onCancel},function(c,g,d,p,o,e){if(c.data.action(c,g,d,p,e)!==false){if(o){var f=(e==true)?0:250;b("#"+b(this).attr("id")+g).fadeOut(f,function(){b(this).remove()})}}});b(this).bind("uploadifyClearQueue",{action:settings.onClearQueue},function(c,d){var e=(settings.queueID)?settings.queueID:b(this).attr("id")+"Queue";if(d){b("#"+e).find(".uploadifyQueueItem").remove()}if(c.data.action(c,d)!==false){b("#"+e).find(".uploadifyQueueItem").each(function(){var f=b(".uploadifyQueueItem").index(this);b(this).delay(f*100).fadeOut(250,function(){b(this).remove()})})}});var l=[];b(this).bind("uploadifyError",{action:settings.onError},function(c,g,d,e){if(c.data.action(c,g,d,e)!==false){var f=new Array(g,d,e);l.push(f);b("#"+b(this).attr("id")+g).find(".percentage").text(" - "+e.type+" Error");b("#"+b(this).attr("id")+g).addClass("uploadifyError")}});if(typeof(settings.onUpload)=="function"){b(this).bind("uploadifyUpload",settings.onUpload)}b(this).bind("uploadifyProgress",{action:settings.onProgress,toDisplay:settings.displayData},function(d,f,e,c){if(d.data.action(d,f,e,c)!==false){b("#"+b(this).attr("id")+f+"ProgressBar").animate({width:c.percentage+"%"},250,function(){if(c.percentage==100){b(this).closest(".uploadifyProgress").fadeOut(250,function(){b(this).remove()})}});if(d.data.toDisplay=="percentage"){displayData=" - "+c.percentage+"%"}if(d.data.toDisplay=="speed"){displayData=" - "+c.speed+"KB/s"}if(d.data.toDisplay==null){displayData=" "}b("#"+b(this).attr("id")+f).find(".percentage").text(displayData)}});b(this).bind("uploadifyComplete",{action:settings.onComplete},function(d,g,e,f,c){if(d.data.action(d,g,e,unescape(f),c)!==false){b("#"+b(this).attr("id")+g).find(".percentage").text(" - Completed");if(settings.removeCompleted){b("#"+b(d.target).attr("id")+g).fadeOut(250,function(){b(this).remove()})}b("#"+b(d.target).attr("id")+g).addClass("completed")}});if(typeof(settings.onAllComplete)=="function"){b(this).bind("uploadifyAllComplete",{action:settings.onAllComplete},function(d,c){if(d.data.action(d,c)!==false){l=[]}})}})},uploadifySettings:function(m,i,p){var l=false;b(this).each(function(){if(m=="scriptData"&&i!=null){if(p){var e=i}else{var e=b.extend(settings.scriptData,i)}var c="";for(var d in e){c+="&"+d+"="+escape(e[d])}i=c.substr(1)}l=document.getElementById(b(this).attr("id")+"Uploader").updateSettings(m,i)});if(i==null){if(m=="scriptData"){var a=unescape(l).split("&");var n=new Object();for(var o=0;o<a.length;o++){var k=a[o].split("=");n[k[0]]=k[1]}l=n}return l}},uploadifyUpload:function(a){b(this).each(function(){document.getElementById(b(this).attr("id")+"Uploader").startFileUpload(a,false)})},uploadifyCancel:function(a){b(this).each(function(){document.getElementById(b(this).attr("id")+"Uploader").cancelFileUpload(a,true,true,false)})},uploadifyClearQueue:function(){b(this).each(function(){document.getElementById(b(this).attr("id")+"Uploader").clearFileUploadQueue(false)})}})})(jQuery)};